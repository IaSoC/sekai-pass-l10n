# 安全政策

## 支持的版本

目前我们仅支持最新版本的代码。

| 版本 | 支持状态 |
| :--- | :--- |
| 最新版 (main) | ✅ |
| 旧版本 | ❌ |

## 报告漏洞

我们非常重视项目的安全性。如果你发现了任何安全漏洞，请**不要**直接在 GitHub Issue 中公开报告。

### 报告方式

请通过以下方式联系我们：

- 在哔哩哔哩私信 bili_47177171806（https://space.bilibili.com/3546904856103196，UID: 3546904856103196）
- 或者通过 GitHub Security Advisories 提交私密报告：https://github.com/bili-47177171806/sekai-pass/security/advisories/new

### 报告内容

请在报告中包含以下信息：

1. **漏洞类型**：例如 SQL 注入、XSS、CSRF、认证绕过等。
2. **严重程度**：低、中、高、严重。
3. **影响范围**：哪些功能或组件受到影响。
4. **复现步骤**：详细的步骤说明，包括必要的配置和环境信息。
5. **概念验证 (PoC)**：如果可能，提供 PoC 代码或截图。
6. **建议的修复方案**（可选）：如果你有修复建议，我们非常欢迎。

### 响应时间

- **确认**：我们会在 48 小时内确认收到报告。
- **初步评估**：我们会在 7 天内完成初步评估并告知严重程度。
- **修复时间**：根据漏洞严重程度，我们会尽快修复：
  - 严重漏洞：7 天内
  - 高危漏洞：14 天内
  - 中危漏洞：30 天内
  - 低危漏洞：60 天内

### 披露政策

在修复发布之前，请不要公开披露漏洞细节。我们会在修复完成后：

1. 发布安全更新。
2. 在 Release Notes 中说明修复的安全问题（不包含详细利用方式）。
3. 在适当的时候（通常是修复发布 30 天后）公开完整的漏洞详情。
4. 在致谢中感谢报告者（如果你愿意）。

## 安全最佳实践

如果你要部署 SEKAI Pass，请遵循以下安全最佳实践：

### 1. 环境配置

- ✅ 使用强随机密钥作为 `KEY_ENCRYPTION_SECRET`
- ✅ 定期轮换密钥和令牌
- ✅ 在生产环境中强制使用 HTTPS
- ✅ 正确配置 CORS 和 CSP 头部

### 2. 数据库安全

- ✅ 定期备份 D1 数据库
- ✅ 限制数据库访问权限
- ✅ 监控异常查询活动

### 3. 密钥管理

- ✅ 不要在代码中硬编码密钥
- ✅ 使用 Cloudflare Secrets 存储敏感信息
- ✅ 不要将 `wrangler.toml` 或 `.dev.vars` 提交到公共仓库

### 4. OAuth/OIDC 安全

- ✅ 验证所有 redirect_uri
- ✅ 强制使用 PKCE（已默认启用）
- ✅ 使用短期访问令牌（1 小时）
- ✅ 实施令牌轮换机制（已默认启用）
- ✅ 验证 state 参数防止 CSRF

### 5. 监控和日志

- ✅ 启用 Cloudflare Workers 日志
- ✅ 监控异常登录尝试
- ✅ 设置告警机制

## 已知安全特性

SEKAI Pass 已实现以下安全特性：

- ✅ PBKDF2 密码哈希（100,000 次迭代，SHA-256）
- ✅ 强制 PKCE（OAuth 2.1 合规）
- ✅ 短期访问令牌（1 小时）
- ✅ 刷新令牌轮换
- ✅ 授权码单次使用
- ✅ State 参数 CSRF 防护
- ✅ ID Token 签名（ES256）
- ✅ 安全 Cookie（SameSite=Lax）
- ✅ 生产环境强制 HTTPS

感谢你帮助我们维护项目的安全！
